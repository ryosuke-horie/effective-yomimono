# Issue #483: MCP要約生成機能のUX改善に関する調査

## 概要

Issue #483では、MCP（Model Context Protocol）を使用した要約生成機能のUXに関する問題が報告されています。主な問題は、要約の品質がプロンプトに左右されることと、実際の記事内容を確認せずに要約を生成してしまうことです。

## 現状の問題点

### 1. 要約品質の問題
- **プロンプト依存性**: 要約の観点がプロンプトに大きく左右される
- **内容未確認**: 記事の実際の内容を確認せずに要約を生成してしまう
- **大量処理時の品質低下**: 特に未要約記事が大量にある場合、品質の低い要約を作成しやすい

### 2. 技術的な問題
現在の実装（`mcp/src/index.ts`）を確認したところ、以下の問題が判明：

```typescript
// 現在はモック実装
const generateSummary: Tool = {
  name: "generateSummary",
  description: "Generate a summary for a bookmark",
  inputSchema: {
    type: "object",
    properties: {
      bookmarkId: { type: "number" },
      maxLength: { type: "number", default: 500 },
      includeKeyPoints: { type: "boolean", default: true },
    },
    required: ["bookmarkId"],
  },
  handler: async (args: any) => {
    // 実際の記事内容を取得せずに汎用的なテンプレート要約を返している
    const summary = `この記事は${bookmark.title}について解説しています。
主なポイント：
- 技術的な詳細について説明
- 実装方法の解説
- ベストプラクティスの紹介

詳細は元記事をご確認ください。`;
  }
};
```

### 3. UXの問題点
- **コンテキストの欠如**: ユーザーは記事を読まずに要約生成を実行できる
- **品質フィードバックの不足**: 生成された要約の品質を確認する仕組みがない
- **バッチ処理の誘導**: UIが大量処理を促進し、品質より量を重視する設計

## 現在のシステム構成

### フロントエンド
- 要約表示機能は適切に実装されている（展開/折りたたみ、コピー機能）
- 要約ボタンの配置は最近改善された（#480）
- 要約の有無を視覚的に判別できる

### バックエンド
- 要約保存/更新のAPIエンドポイントは整備済み
- データベーススキーマに要約フィールドとタイムスタンプを含む
- 実際のLLM統合や記事コンテンツ取得は未実装

### MCP統合
- Claude Desktopとの連携は確立
- ツール定義は適切に行われている
- 実際の記事解析ロジックが欠けている

## 改善提案

### 1. 短期的改善（Quick Win）
- **記事プレビュー機能**: 要約生成前に記事の一部を表示
- **品質確認ステップ**: 生成後に要約を確認・編集できるステップを追加
- **プロンプトテンプレート**: 用途別のプロンプトテンプレートを提供

### 2. 中期的改善
- **実際の記事内容取得**: WebFetchまたは専用のスクレイピング機能を実装
- **段階的要約生成**: 
  1. 記事の構造解析
  2. 主要セクションの抽出
  3. 要約生成
  4. 品質検証
- **ユーザーガイダンス**: 良い要約を作るためのヒントやベストプラクティスを表示

### 3. 長期的改善
- **機械学習による品質評価**: 要約の品質を自動評価する仕組み
- **ユーザーフィードバック**: 要約の有用性を評価できる機能
- **パーソナライズ**: ユーザーの好みに応じた要約スタイルの学習

## 参考事例の調査

### 1. Notion AI
- コンテキストを考慮した要約生成
- ユーザーが編集可能な要約
- 複数の要約スタイルオプション

### 2. Readwise Reader
- ハイライトベースの要約
- 段階的な要約（短い→詳細）
- ソース参照の明確化

### 3. Instapaper
- 記事の重要部分の自動検出
- 読了時間の推定
- テキスト密度に基づく要約長の調整

## 実装優先度

1. **高優先度**
   - 実際の記事内容取得機能の実装
   - 要約生成前の確認ステップ
   - 基本的な品質検証

2. **中優先度**
   - プロンプトテンプレート機能
   - バッチ処理時の品質維持機能
   - ユーザーガイダンス

3. **低優先度**
   - 高度な品質評価
   - パーソナライズ機能
   - 機械学習ベースの改善

## 次のステップ

1. 記事内容取得機能の技術検証
2. プロトタイプの作成とユーザーテスト
3. 段階的な機能実装
4. フィードバック収集と改善

## 結論

現在のMCP要約生成機能は、実際の記事内容を解析せずにテンプレート的な要約を生成しているため、ユーザーにとって価値の低い機能となっています。実装の優先順位を考慮しながら、段階的に改善を進めることで、より有用な要約生成機能を提供できるようになります。